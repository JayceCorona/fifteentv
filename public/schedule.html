<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule Your Slot - Fifteen.tv</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Add React and Stream Chat dependencies directly -->
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/stream-chat@8/dist/browser.min.js"></script>
    <script src="https://unpkg.com/stream-chat-react@10/dist/browser.min.js"></script>
    <link href="https://unpkg.com/stream-chat-react@10/dist/css/index.css" rel="stylesheet">
</head>
<body>  
    <div class="content-wrapper">
        <div class="left-side">
            <section class="video-section">
                <div class="video-player">
                    <video id="mainPlayer" playsinline>
                        <source src="" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="video-controls">
                        <button id="playPauseBtn" class="control-btn">Play</button>
                        <button id="muteBtn" class="control-btn">Mute</button>
                        <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="1">
                        <div class="time-display">
                            <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
                        </div>
                        <div class="progress-bar">
                            <div id="progress"></div>
                        </div>
                    </div>
                    <div class="static-text">
                        <span>N</span><span>O</span>
                        <span> </span>
                        <span>S</span><span>I</span><span>G</span><span>N</span><span>A</span><span>L</span>
                    </div>
                </div>
            </section>
            
            <section class="schedule-section">
                <div id="schedule-grid">
                    <!-- Schedule content will be generated here -->
                </div>
            </section>
        </div>
        <div id="chat-root" style="width: 300px; height: 100vh;"></div>
    </div>

    <!-- Add this script at the end of body -->
    <script>
        // Initialize Stream Chat
        const chatClient = StreamChat.getInstance('g9m53zqntv69');
        
        // Generate a random user ID if not exists
        const userId = localStorage.getItem('chatUserId') || 
                      'user-' + Math.random().toString(36).substring(7);
        localStorage.setItem('chatUserId', userId);

        // Simple Chat Component
        const ChatComponent = () => {
            const [channel, setChannel] = React.useState(null);

            React.useEffect(() => {
                async function initializeChat() {
                    try {
                        // Get token from server
                        const response = await fetch('https://fifteentv-a5b5844eddeb.herokuapp.com/token', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ userId })
                        });
                        const { token } = await response.json();

                        // Connect user
                        await chatClient.connectUser(
                            {
                                id: userId,
                                name: `User ${userId.substring(0, 6)}`,
                            },
                            token
                        );

                        // Create and watch channel
                        const channel = chatClient.channel('messaging', 'fifteen-tv-chat', {
                            name: 'Fifteen.tv Chat Room',
                        });
                        await channel.watch();
                        setChannel(channel);
                    } catch (error) {
                        console.error('Chat initialization error:', error);
                    }
                }

                initializeChat();
                return () => chatClient.disconnectUser();
            }, []);

            if (!channel) {
                return React.createElement('div', {
                    style: { padding: '20px', textAlign: 'center' }
                }, 'Loading chat...');
            }

            return React.createElement(StreamChatReact.Chat, 
                { client: chatClient, theme: 'messaging light' },
                React.createElement(StreamChatReact.Channel, { channel },
                    React.createElement(StreamChatReact.Window, null,
                        React.createElement(StreamChatReact.ChannelHeader, { title: 'Live Chat' }),
                        React.createElement(StreamChatReact.MessageList),
                        React.createElement(StreamChatReact.MessageInput)
                    )
                )
            );
        };

        // Render the chat
        ReactDOM.render(
            React.createElement(ChatComponent),
            document.getElementById('chat-root')
        );
    </script>

    <!-- Your existing scripts -->
    <script src="script.js"></script>
</body>
</html>
